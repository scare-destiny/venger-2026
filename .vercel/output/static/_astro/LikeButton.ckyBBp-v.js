import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as n}from"./index.RH_Wq4ov.js";/* empty css                       */function y({slug:i}){const[f,o]=n.useState(0),[d,u]=n.useState(!1),[h,l]=n.useState(""),[m,p]=n.useState(!0),t=n.useRef(null),s=n.useRef(null);n.useEffect(()=>{(async()=>{try{const a=Date.now(),r=await fetch(`/api/likes/${encodeURIComponent(i)}?t=${a}&fresh=${Math.random()}`,{cache:"no-store",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}});if(r.ok){const k=await r.json();o(k.likes)}else o(0)}catch(a){console.log(a),o(0)}finally{p(!1)}})()},[i]);const g=async()=>{if(!d){u(!0),l(""),t.current&&t.current.classList.add("clicked","liked"),s.current&&s.current.classList.add("updating");try{const c={user_agent:navigator.userAgent,language:navigator.language,referrer:document.referrer,screenResolution:`${screen.width}x${screen.height}`,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timestamp:new Date().toISOString()},a=await fetch("/api/likes/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({slug:i,analytics:c})});if(a.ok){const r=await a.json();setTimeout(()=>{o(r.likes),s.current&&(s.current.style.animation="countUp 0.4s ease")},100),setTimeout(()=>{s.current&&(s.current.classList.remove("updating"),s.current.style.animation="")},400)}else{t.current&&t.current.classList.remove("liked");const r=await a.json().catch(()=>({message:"Unable to add like. Please try again.",likes:0}));l(r.message||"Unable to add like. Please try again.")}}catch(c){t.current&&t.current.classList.remove("liked"),console.error("Error adding like:",c),l("Connection error. Please check your internet and try again.")}finally{u(!1),setTimeout(()=>{t.current&&t.current.classList.remove("clicked")},600)}}};return m?e.jsxs("div",{className:"like-button-container",children:[e.jsx("div",{className:"like-button loading",children:e.jsx("svg",{width:"24",height:"20",viewBox:"0 0 50 42",fill:"none",className:"heart-icon",children:e.jsx("path",{className:"heart-path",d:"M13.2537 0.0255029C23.4033 0.0255029 25.0273 10.5191 25.0273 10.5191C25.0273 10.5191 26.6512 -0.60088 37.6129 0.0255029C44.3441 0.410148 48.7484 6.32169 48.9804 12.1981C49.7924 32.7656 28.7678 41.5 25.0273 41.5C21.2868 41.5 -0.549833 32.3459 1.07416 12.1981C1.54782 6.32169 6.29929 0.0255029 13.2537 0.0255029Z",fill:"url(#inactive-gradient-loading)"})})}),e.jsx("span",{className:"like-count",children:"..."})]}):e.jsxs("div",{className:"like-button-container",children:[e.jsx("button",{ref:t,className:"like-button","aria-label":"Like this post",onClick:g,disabled:d,children:e.jsxs("svg",{width:"24",height:"20",viewBox:"0 0 50 42",fill:"none",className:"heart-icon",children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:`active-gradient-${i}`,x1:"25",y1:"42",x2:"26.3796",y2:"0.0453673",gradientUnits:"userSpaceOnUse",children:[e.jsx("stop",{stopColor:"hsl(353deg, 100%, 52%)"}),e.jsx("stop",{offset:"1",stopColor:"hsl(313deg, 100%, 52%)"})]}),e.jsxs("linearGradient",{id:`inactive-gradient-${i}`,x1:"15",y1:"41",x2:"42",y2:"-1.5",gradientUnits:"userSpaceOnUse",children:[e.jsx("stop",{stopColor:"#666",stopOpacity:"0.8"}),e.jsx("stop",{offset:"1",stopColor:"#999",stopOpacity:"0.8"})]})]}),e.jsx("path",{className:"heart-path",d:"M13.2537 0.0255029C23.4033 0.0255029 25.0273 10.5191 25.0273 10.5191C25.0273 10.5191 26.6512 -0.60088 37.6129 0.0255029C44.3441 0.410148 48.7484 6.32169 48.9804 12.1981C49.7924 32.7656 28.7678 41.5 25.0273 41.5C21.2868 41.5 -0.549833 32.3459 1.07416 12.1981C1.54782 6.32169 6.29929 0.0255029 13.2537 0.0255029Z",fill:`url(#inactive-gradient-${i})`})]})}),e.jsx("span",{ref:s,className:"like-count",children:f.toLocaleString()}),h&&e.jsx("div",{className:"like-error-message",children:h})]})}export{y as default};
